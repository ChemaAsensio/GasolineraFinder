<div class="home-container">

  <!-- MODE SWITCH -->
  <div class="mode-switch" role="tablist" aria-label="Modo de bÃºsqueda">
    <button
      type="button"
      class="mode-pill"
      [class.active]="modoSeleccionado === 'buscar'"
      (click)="setModo('buscar')"
      aria-pressed="{{ modoSeleccionado === 'buscar' }}"
    >
      Buscar Gasolineras
    </button>

    <button
      type="button"
      class="mode-pill"
      [class.active]="modoSeleccionado === 'ruta'"
      (click)="setModo('ruta')"
      aria-pressed="{{ modoSeleccionado === 'ruta' }}"
    >
      Gasolineras en Ruta
    </button>
  </div>

  <!-- ACORDEÃ“N: UbicaciÃ³n de Inicio -->
  <div class="acordeon-mejorado" [class.cerrado]="!acordeonAbierto.inicio">
    <div class="acordeon-cabecera" (click)="toggleAcordeon('inicio')">
      <div class="acordeon-titulo">
        <div class="acordeon-icono-grande">
          <span class="icono">ğŸ </span>
        </div>
        <div class="acordeon-texto">
          <h3>Inicio</h3>
        </div>
      </div>
      <div class="acordeon-flecha" [class.abierto]="acordeonAbierto.inicio">
        <span>â–¼</span>
      </div>
    </div>

    <div class="acordeon-contenido" *ngIf="acordeonAbierto.inicio">
      <div class="contenido-interior">
        <div class="direccion-container">
          <div class="campos-grid">
            <div class="campo-direccion">
              <label for="calleInicio">ğŸ“ Calle:</label>
              <input id="calleInicio" [(ngModel)]="ubicacionUsuario.calle" placeholder="Ej: Gran VÃ­a" />
            </div>

            <div class="campo-direccion">
              <label for="numeroInicio">ğŸ”¢ NÃºmero:</label>
              <input id="numeroInicio" [(ngModel)]="ubicacionUsuario.numero" placeholder="Ej: 28" />
            </div>

            <div class="campo-direccion">
              <label for="ciudadInicio">ğŸ™ï¸ Ciudad:</label>
              <input id="ciudadInicio" [(ngModel)]="ubicacionUsuario.ciudad" placeholder="Ej: Madrid" />
            </div>

            <div class="campo-direccion">
              <label for="provinciaInicio">ğŸ—ºï¸ Provincia:</label>
              <input id="provinciaInicio" [(ngModel)]="ubicacionUsuario.provincia" placeholder="Ej: Madrid" />
            </div>
          </div>

          <div class="botones-accion-container">
           <button (click)="obtenerUbicacion()" class="btn-ubicacion-elegante" title="Detectar mi ubicaciÃ³n automÃ¡ticamente">
            <span class="btn-ubicacion-icono">ğŸ“</span>
            <span class="btn-ubicacion-texto">Mi ubicaciÃ³n</span>
        </button>

        </div>
      </div>
    </div>
  </div>

  <!-- ACORDEÃ“N: UbicaciÃ³n de Destino (solo modo ruta) -->
  <div
    class="acordeon-mejorado"
    *ngIf="modoSeleccionado === 'ruta'"
    [class.cerrado]="!acordeonAbierto.destino"
  >
    <div class="acordeon-cabecera" (click)="toggleAcordeon('destino')">
      <div class="acordeon-titulo">
        <div class="acordeon-icono-grande">
          <span class="icono">ğŸ¯</span>
        </div>
        <div class="acordeon-texto">
          <h3>Destino</h3>
          
        </div>
      </div>
      <div class="acordeon-flecha" [class.abierto]="acordeonAbierto.destino">
        <span>â–¼</span>
      </div>
    </div>

    <div class="acordeon-contenido" *ngIf="acordeonAbierto.destino">
      <div class="contenido-interior">
        <div class="direccion-container">
          <div class="campos-grid">
            <div class="campo-direccion">
              <label for="calleDestino">ğŸ“ Calle:</label>
              <input id="calleDestino" [(ngModel)]="destino.calle" placeholder="Ej: Avenida Diagonal" />
            </div>

            <div class="campo-direccion">
              <label for="numeroDestino">ğŸ”¢ NÃºmero:</label>
              <input id="numeroDestino" [(ngModel)]="destino.numero" placeholder="Ej: 407" />
            </div>

            <div class="campo-direccion">
              <label for="ciudadDestino">ğŸ™ï¸ Ciudad:</label>
              <input id="ciudadDestino" [(ngModel)]="destino.ciudad" placeholder="Ej: Barcelona" />
            </div>

            <div class="campo-direccion">
              <label for="provinciaDestino">ğŸ—ºï¸ Provincia:</label>
              <input id="provinciaDestino" [(ngModel)]="destino.provincia" placeholder="Ej: Barcelona" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ACORDEÃ“N: Filtros -->
  <div class="acordeon-mejorado" [class.cerrado]="!acordeonAbierto.filtros">
    <div class="acordeon-cabecera" (click)="toggleAcordeon('filtros')">
      <div class="acordeon-titulo">
        <div class="acordeon-icono-grande">
          <span class="icono">âš™ï¸</span>
        </div>
        <div class="acordeon-texto">
          <h3>Filtros</h3>
        </div>
      </div>
      <div class="acordeon-flecha" [class.abierto]="acordeonAbierto.filtros">
        <span>â–¼</span>
      </div>
    </div>

    <div class="acordeon-contenido" *ngIf="acordeonAbierto.filtros">
      <div class="contenido-interior">
        <app-filters
          [empresasDisponibles]="empresasDisponibles"
          [filters]="filters"
          (filterChange)="onFiltersCambiados($event)"
        ></app-filters>
      </div>
    </div>
  </div>

  <!-- BOTÃ“N DE BÃšSQUEDA -->
<div class="botones-busqueda-container">
  <button 
    (click)="ejecutarBusqueda()" 
    class="btn-busqueda-principal"
    [class.cargando]="busquedaEnCurso"
    [disabled]="busquedaEnCurso">
    <span class="btn-busqueda-icono">{{ busquedaEnCurso ? 'â³' : 'ğŸ”' }}</span>
    <span class="btn-busqueda-texto">
      {{ busquedaEnCurso ? 'Buscando...' : 'Buscar gasolineras' }}
      <span *ngIf="!busquedaEnCurso && mostrarResultados && gasolinerasFiltradas.length > 0" class="contador-preview">
        
      </span>
    </span>
  </button>
</div>

  <!-- ACORDEÃ“N: Resultados -->
  <div class="acordeon-mejorado" 
       id="resultados-container"
       *ngIf="mostrarResultados" 
       [class.cerrado]="!acordeonAbierto.resultados">

    <div class="acordeon-cabecera" (click)="toggleAcordeon('resultados')">
      <div class="acordeon-titulo">
        <div class="acordeon-icono-grande">
          <span class="icono">â›½</span>
        </div>
        <div class="acordeon-texto">
          <h3>Resultados</h3>
        </div>
      </div>
      <div class="acordeon-flecha" [class.abierto]="acordeonAbierto.resultados">
        <span>â–¼</span>
      </div>
    </div>
    
    <div class="acordeon-contenido" *ngIf="acordeonAbierto.resultados">
      <div class="contenido-interior">
        
        <!-- Mensajes de estado dentro del acordeÃ³n -->
        <div *ngIf="cargando" class="estado-cargando">
          <p>Cargando gasolineras...</p>
        </div>

        <div *ngIf="error" class="estado-error">
          <p>âŒ {{ error }}</p>
        </div>

        <div *ngIf="!cargando && !error && gasolinerasFiltradas.length === 0" class="estado-vacio">
          <p>ğŸ“­ No se encontraron gasolineras con los filtros aplicados</p>
          <button (click)="restablecerFiltros()" class="btn-secundario">
            Restablecer filtros
          </button>
        </div>

        <!-- Mostrar resultados solo si hay gasolineras -->
        <div *ngIf="!cargando && !error && gasolinerasFiltradas.length > 0">
          <app-summary-box 
            [stations]="gasolinerasFiltradas"
            [filters]="filters"
            [ubicacionUsuario]="ubicacionUsuario"> 
          </app-summary-box>
        </div>

      </div>
    </div>

  </div>

  <!-- BotÃ³n Restablecer todo (fuera del acordeÃ³n de resultados) -->
  <div class="restablecer-container">
    <button (click)="restablecerTodo()" class="btn-restablecer-todo">
      ğŸ”„ Restablecer todo
    </button>
  </div>

  <!-- BotÃ³n Scroll to Top -->
  <button 
    class="scroll-top-btn" 
    [class.visible]="mostrarBotonScrollTop"
    (click)="scrollToTop()"
    aria-label="Volver arriba"
    title="Volver arriba">
    â†‘
  </button>

</div>