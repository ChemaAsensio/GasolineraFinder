<div class="summary-box">
  <!-- ğŸ“… INFORMACIÃ“N TEMPORAL (SIN RECUADRO) -->
  <div class="info-temporal">
    <h3 class="section-title sin-recuadro">ğŸ“… INFORMACIÃ“N TEMPORAL</h3>
    <div class="info-row sin-borde">
      <span class="info-label">ğŸ“… Fecha:</span>
      <span class="info-value">{{ fechaActual }}</span>
    </div>
    <div class="info-row sin-borde">
      <span class="info-label">ğŸ• Hora:</span>
      <span class="info-value">{{ horaActual }}</span>
    </div>
  </div>

  <!-- ğŸ“ INFORMACIÃ“N DE BÃšSQUEDA (CON RECUADRO) -->
  <div class="summary-section" *ngIf="filters">
    <h3 class="section-title">ğŸ“ INFORMACIÃ“N DE BÃšSQUEDA</h3>
    <div class="info-row">
      <span class="info-label">ğŸ“ UbicaciÃ³n:</span>
      <span class="info-value">{{ obtenerUbicacionFormateada() }}</span>
    </div>
    <div class="info-row">
      <span class="info-label">ğŸ“ Radio de bÃºsqueda:</span>
      <span class="info-value">{{ (filters.maxDistance ?? 50) }} km</span>
    </div>
    <div class="info-row">
      <span class="info-label">â›½ Combustible:</span>
      <span class="info-value">{{ obtenerTipoCombustibleSeleccionado() }}</span>
    </div>
  </div>

  <!-- ğŸ“Š ESTADÃSTICAS (CON RECUADRO) -->
  <div class="summary-section">
    <h3 class="section-title">ğŸ“Š ESTADÃSTICAS</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">{{ estadisticas.total }}</div>
        <div class="stat-label">Gasolineras</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ formatPrice(estadisticas.precioPromedio) }}</div>
        <div class="stat-label">Precio promedio</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ formatPercentage(estadisticas.porcentajeAbiertasAhora) }}</div>
        <div class="stat-label">Abiertas ahora</div>
      </div>
    </div>
  </div>

  <!-- âœ… MODO BUSCAR: TOP 3 -->
  <div class="summary-section" *ngIf="modo === 'buscar' && stations.length > 0">
    <h3 class="section-title">â›½ TOP 3 RECOMENDADAS</h3>
    <div class="top-stations">
      <div *ngFor="let gasolinera of stations.slice(0, 3); let i = index" class="top-station" [class.highlighted]="i === 0">
        <div class="station-rank">#{{ i + 1 }}</div>
        <div class="station-info">
          <strong>{{ cleanCompanyName(gasolinera.rotulo) }}</strong>
          <div class="station-address">{{ getDireccionVisible(gasolinera) }}</div>
          <div class="station-details">
            <span class="price">{{ formatPrice(obtenerPrecioRelevante(gasolinera)) }}/L</span>
            <span class="distance distance-centered">{{ (gasolinera.distanceKm ?? 0) > 0 ? ((gasolinera.distanceKm ?? 0).toFixed(2) + ' km') : '--' }}</span>
            <span class="schedule schedule-right">{{ formatearHorario(gasolinera.horario) }}</span>
          </div>
          <div class="route-summary" *ngIf="getRouteInfo(gasolinera)">
            <span class="route-item">ğŸ›£ï¸ DesvÃ­o: {{ (getDesvioKm(gasolinera) ?? 0) | number:'1.1-1' }} km</span>
            <span class="route-item">ğŸ’¸ Coste desvÃ­o: {{ formatPrice(getDesvioEuro(gasolinera) ?? 0) }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="results-info">
      <p>{{ stations.length }} gasolineras encontradas</p>
    </div>
  </div>

<!-- âœ… MODO RUTA: TABLA POR CUBOS (SIN TOP 3) -->
<div class="summary-section" *ngIf="modo === 'ruta' && stations.length > 0">
  <h3 class="section-title">â›½ Gasolineras por km (ruta)</h3>
  <div class="ruta-table-wrap">
    <table class="ruta-table">
      <thead>
        <tr>
          <th class="col-empresa">EMPRESA</th>
          <th class="col-dir">DIRECCIÃ“N</th>
          <th class="col-precio">PRECIO</th>
          <th class="col-km">DESVÃO KM</th>
          <th class="col-eur">DESVÃO â‚¬</th>
          <th class="col-horario">HORARIO</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let b of rutasPorCubo; let bucketIndex = index">
          <!-- Fila de separador de cubo -->
          <tr class="bucket-separator" *ngIf="bucketIndex > 0">
            <td colspan="6"></td>
          </tr>
          
          <!-- Fila de tÃ­tulo del cubo -->
          <tr class="bucket-title">
            <td colspan="6">
              <div class="bucket-title-content">
                <span class="bucket-km">Km {{ b.fromKm }}â€“{{ b.toKm }}</span>
              </div>
            </td>
          </tr>
          
          <!-- Filas de gasolineras -->
          <tr *ngFor="let r of b.items; let last = last" 
              [class.last-in-bucket]="last">
            <td class="col-empresa">
              <strong>{{ cleanCompanyName(r.station.rotulo) }}</strong>
            </td>
            <td class="col-dir">{{ getDireccionCompleta(r.station) }}</td>
            <td class="col-precio">{{ formatPrice(r.precio) }}/L</td>
            <td class="col-km">{{ formatKm1(r.desvioKm) }}</td>
            <td class="col-eur">{{ formatEur2(r.desvioEur) }}</td>
            <td class="col-horario">
              <span class="horario-chip">â–ˆ {{ formatearHorario(r.horario) }}</span>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
  <div class="results-info">
    <p>{{ stations.length }} gasolineras encontradas</p>
  </div>
</div>

  <!-- Mensaje cuando no hay filtros -->
  <div class="summary-section" *ngIf="!filters">
    <h3 class="section-title">ğŸ“ INFORMACIÃ“N DE BÃšSQUEDA</h3>
    <div class="info-row">
      <span class="info-label">â³ Estado:</span>
      <span class="info-value">Esperando configuraciÃ³n de filtros...</span>
    </div>
  </div>
</div>